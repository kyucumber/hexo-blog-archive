<!DOCTYPE html><html lang="kr"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Spring Ehcache 적용하기 | Devlog</title><link rel="stylesheet" href="/libs/spoqa-han-sans-kr/css/SpoqaHanSans-kr.css"><link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="/css/highlights/dracula.css"><link rel="canonical" href="http://yoursite.com/java/spring/ehcache/"/>
<meta name="description" content="EhCache를 적용하려면 두가지 의존성을 추가해야 한다. 12compile(&apos;org.springframework.boot:spring-boot-starter-cache&apos;)compile group: &apos;net.sf.ehcache&apos;, name:…">
<meta name="keywords" content="Java,Spring,EhCache">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Ehcache 적용하기">
<meta property="og:url" content="http://yoursite.com/java/spring/ehcache/">
<meta property="og:site_name" content="Devlog">
<meta property="og:description" content="EhCache를 적용하려면 두가지 의존성을 추가해야 한다. 12compile(&apos;org.springframework.boot:spring-boot-starter-cache&apos;)compile group: &apos;net.sf.ehcache&apos;, name:…">
<meta property="og:locale" content="kr">
<meta property="og:image" content="http://yoursite.com/images/java/spring/spring.jpg">
<meta property="og:updated_time" content="2018-08-05T16:08:59.026Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Spring Ehcache 적용하기">
<meta name="twitter:description" content="EhCache를 적용하려면 두가지 의존성을 추가해야 한다. 12compile(&apos;org.springframework.boot:spring-boot-starter-cache&apos;)compile group: &apos;net.sf.ehcache&apos;, name:…">
<meta name="twitter:image" content="http://yoursite.com/images/java/spring/spring.jpg"><meta property="article:author" content="https://www.facebook.com/xmfpes"><meta property="twitter:label1" content="Published at"><meta property="twitter:data1" content="2018-08-06 00:00:00"><meta property="twitter:label2" content="Written by"><meta property="twitter:data2" content="KyuNam"><link rel="icon" href="/images/internet.png"><link rel="alternate" href="/atom.xml" type="application/atom+xml" title="Devlog"></head><body itemscope itemtype="https://schema.org/WebPage"><nav class="menu" id="menu"><div class="menu-inner"><div class="menu__left-area"><div class="menu__item"><a class="menu__item__link menu__item__link--brand" href="/" title="Home" rel="home"><img class="menu__item__link--brand__image" src="/images/internet.png" alt="Devlog"><span class="menu__item__link--brand__label">Devlog</span></a></div></div><div class="menu__right-area"><div class="menu__item"><a class="menu__item__link" href="/">Home</a></div><div class="menu__item"><a class="menu__item__link" href="/about">About</a></div><div class="menu__item"><a class="menu__item__link" href="/archives">Archives</a></div></div></div></nav><div class="page-background"></div><div class="content-container"><div class="content-outer"><div class="content-inner" itemscope itemtype="https://schema.org/Blog"><article class="article" id="article" itemscope itemtype="https://schema.org/BlogPosting"><h1 class="article__title" itemprop="headline">Spring Ehcache 적용하기</h1><div class="article__meta"><time class="article__meta__time" datetime="2018-08-05T15:00:00.000Z" itemprop="datePublished">2018-08-06 00:00:00</time><div class="article__meta__categories"><a class="article__meta__categories__item" href="/categories/Backend/">Backend</a><span class="article__meta__categories__separator">></span><a class="article__meta__categories__item" href="/categories/Backend/Java/">Java</a><span class="article__meta__categories__separator">></span><a class="article__meta__categories__item" href="/categories/Backend/Java/Spring/">Spring</a></div></div><div class="article__contents"><img src="/images/java/spring/spring.jpg"/><p>EhCache를 적용하려면 두가지 의존성을 추가해야 한다.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">compile('org.springframework.boot:spring-boot-starter-cache')</span></span><br><span class="line"><span class="string">compile</span> <span class="attr">group:</span> <span class="string">'net.sf.ehcache'</span><span class="string">,</span> <span class="attr">name:</span> <span class="string">'ehcache'</span><span class="string">,</span> <span class="attr">version:</span> <span class="string">'2.9.0'</span></span><br></pre></td></tr></table></figure>
<p><code>spring-boot-starter-cache</code> 를 추가하면 캐시 관련 의존성(CacheManager 등)을 직접 추가하지 않아도 된다.</p>
<p>spring-starter-cache에서는 기본적으로 <code>ConcurrentHashMap</code> 을 사용하는데 이를 <code>Ehcache</code> 를 사용하도록 변경하기 위해서 아래의 ehcache 의존성을 추가했다.</p>
<p>기본적으로 ehcache 의존성이 적용되기 전 CacheManager는<code>ConcurrentMapCacheManager</code> 로 설정되고 ehcache 의존성을 적용하고 나면 <code>EhCacheCacheManager</code> 로 변경, 자동으로 적용된다.</p>
<p>캐싱 설정 정보는 디폴트로 resources 아래의 <code>ehcache.xml</code> 파일을 보는데 아래처럼 직접 지정해 줄 수 있음.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line"><span class="attr">  cache:</span></span><br><span class="line"><span class="attr">    ehcache:</span></span><br><span class="line"><span class="attr">      config:</span> <span class="attr">classpath:ehcache.xml</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line"><span class="comment"># application.properties</span></span><br><span class="line"><span class="string">spring.cache.ehcache.config=classpath:ehcache.xml</span></span><br></pre></td></tr></table></figure>
<p>CacheManager가 디폴트 캐시매니저인지 Spring EhcacheManager인지 실행될 때 체크하기 위해서 CommandLineRunner 추가, 캐싱을 사용하기 위해 @EnableCaching 어노테이션을 추가하자.</p>
<p><strong>따로 빈을 만들어 주지 않아도 CacheManager, EhCacheManagerFactoryBean이 생성되게 된다.(하지만 이렇게 디폴트으로 하면 테스트 코드가 동작할 때 CacheManager가 여러번 생성되는지 에러가 발생한다.)</strong></p>
<p>테스트 코드가 돌면서 여러개의 CacheManager를 생성하기 때문인 것 같은데 테스트 코드 동작 시 어떻게 설정이 돌아가길래 이렇게 되는지는 잘 모르겠다. 알면 알려줘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheConfig</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(CacheConfig.class);</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CacheManager cacheManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">"\n\n"</span> + <span class="string">"=========================================================\n"</span></span><br><span class="line">                + <span class="string">"Using cache manager: "</span> + <span class="keyword">this</span>.cacheManager.getClass().getName() + <span class="string">"\n"</span></span><br><span class="line">                + <span class="string">"=========================================================\n\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위와 같은 디폴트 설정 이외에 직접 CacheManager를 빈으로 등록할 수 있다.</p>
<p>디폴트 설정을 사용하면 테스트 코드 실행 시 CacheManager exception이 발생하니까 아래 방법으로 빈을 직접 설정하고 setShared 설정을 true로 두고 사용하자.</p>
<p>shared 설정은 cacheManager 싱글톤 여부를 지정하는 값이라고 하는데. cacheManager 인스턴스가 없으면 생성하도록 true 값을 지정하자.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheConfig</span> <span class="keyword">implements</span> <span class="title">CommandLineRunner</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(CacheConfig.class);</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CacheManager cacheManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EhCacheCacheManager(ehCacheCacheManager().getObject());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> EhCacheManagerFactoryBean <span class="title">ehCacheCacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        EhCacheManagerFactoryBean cmfb = <span class="keyword">new</span> EhCacheManagerFactoryBean();</span><br><span class="line">        cmfb.setConfigLocation(<span class="keyword">new</span> ClassPathResource(<span class="string">"ehcache.xml"</span>));</span><br><span class="line">        cmfb.setShared(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> cmfb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        log.info(<span class="string">"\n\n"</span> + <span class="string">"=========================================================\n"</span></span><br><span class="line">                + <span class="string">"Using cache manager: "</span> + <span class="keyword">this</span>.cacheManager.getClass().getName() + <span class="string">"\n"</span></span><br><span class="line">                + <span class="string">"=========================================================\n\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ehcache-xml-파일-작성"><a href="#ehcache-xml-파일-작성" class="headerlink" title="ehcache.xml 파일 작성"></a>ehcache.xml 파일 작성</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"http://ehcache.org/ehcache.xsd"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">updateCheck</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"java.io.tmpdir"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">defaultCache</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsInMemory</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToIdleSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">timeToLiveSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">overflowToDisk</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxElementsOnDisk</span>=<span class="string">"10000000"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskPersistent</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">diskExpiryThreadIntervalSeconds</span>=<span class="string">"120"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LRU"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"findByBestCategoryCache"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxEntriesLocalHeap</span>=<span class="string">"10000"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">maxEntriesLocalDisk</span>=<span class="string">"1000"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">eternal</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">diskSpoolBufferSizeMB</span>=<span class="string">"20"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">timeToIdleSeconds</span>=<span class="string">"300"</span> <span class="attr">timeToLiveSeconds</span>=<span class="string">"600"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LFU"</span></span></span><br><span class="line"><span class="tag">           <span class="attr">transactionalMode</span>=<span class="string">"off"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">persistence</span> <span class="attr">strategy</span>=<span class="string">"localTempSwap"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>설정을 조금 살펴보면, <code>&lt;defaultCache&gt;</code> 는 코드 내에서 정의한 캐시에 대한 디폴트 값을 의미한다. <code>&lt;cache&gt;</code> 는 하나의 캐시에 대한 설정을 지정할 때 사용함. 자세한 내용은 생략한다.</p>
<ul>
<li>maxEntriesLocalHeap</li>
</ul>
<p>캐시가 로컬 힙 메모리에서 사용할 수있는 캐시 항목 또는 바이트의 최대값</p>
<ul>
<li>timeToIdleSeconds</li>
</ul>
<p>Element가 지정한 시간 동안 사용(조회)되지 않으면 캐시에서 제거된다. 이 값이 0인 경우 조회 관련 만료 시간을 지정하지 않는다. 기본값은 0이다. </p>
<ul>
<li>timeToLiveSeconds</li>
</ul>
<p>Element가 존재하는 시간. 이 시간이 지나면 캐시에서 제거된다. 이 시간이 0이면 만료 시간을 지정하지 않는다. 기본값은 0이다.</p>
<ul>
<li>memoryStoreEvictionPolicy</li>
</ul>
<p>객체의 개수가 maxElementsInMemory에 도달했을 때,모메리에서 객체를 어떻게 제거할 지에 대한 정책을 지정한다. 기본값은 LRU이다. FIFO와 LFU도 지정할 수 있다. </p>
<p>나머지는 알아서 알아보자.</p>
<h2 id="Cacaheable-CacheEvict"><a href="#Cacaheable-CacheEvict" class="headerlink" title="@Cacaheable, @CacheEvict"></a>@Cacaheable, @CacheEvict</h2><p>스프링 starter-cache에서 지원해주는 어노테이션 같은데 위 어노테이션을 사용해서 간편하게 캐싱과 캐시 삭제를 할 수 있다.</p>
<ul>
<li>@Cacheable</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(value=<span class="string">"usercache"</span>, key = <span class="string">"#root.methodName"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Data&gt; <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dataRepository.findAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>위와 같은 코드에 <code>@Cacheable</code> 을 지정하고 밸류와 키를 지정해주면, 저 밸류와 키를 가진 캐시를 생성하고 캐시가 존재한다면 저 메소드가 다시 호출 될 떄 안의 메소드를 호출하지 않고 캐싱 된 값을 가져온다.</p>
<p>key를 따로 지정해주지 않으면 메소드 파라미터가 키 값이 되며, 메소드 파라미터가 없다면 0이 키 값이 된다. <code>@CacheEvict</code> 할 때 참고 할 것.  <a href="http://javaiyagi.tistory.com/352" target="_blank" rel="noopener">참고한 관련 링크</a></p>
<p>파라미터가 없을 시 임의로 스트링 키 값을 지정해 줄 순 없다. 아래와 같은 방법으로 메소드 네임이나 static한 값을 지정해 줄 순 있음. <a href="https://stackoverflow.com/questions/33383366/cacheble-annotation-on-no-parameter-method/33384311" target="_blank" rel="noopener">관련 StackOverFlow 링크</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Cacheable</span>(value=<span class="string">"usercache"</span>, key = <span class="string">"#root.methodName"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MY_KEY = <span class="string">"mykey"</span>;</span><br><span class="line"><span class="meta">@Cacheable</span>(value=<span class="string">"usercache"</span>, key = <span class="string">"#root.target.MY_KEY"</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li>@CacheEvict</li>
</ul>
<p>위에랑 똑같다. 해당 메소드 수행 시 캐시를 삭제하는 어노테이션 키 밸류 값을 가진 캐시를 삭제한다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheEvict</span>(value = <span class="string">"findMemberCache"</span>, key=<span class="string">"#id"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Data <span class="title">update</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> dataRepository.findById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="CacheManager-already-exists-in-the-same-VM"><a href="#CacheManager-already-exists-in-the-same-VM" class="headerlink" title="CacheManager already exists in the same VM"></a>CacheManager already exists in the same VM</h2><p>캐싱 관련 빈 설정을 디폴트로 두고 사용하다가 테스트 코드 동작 과정에서 아래와 같은 에러 발생시</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;ehCacheCacheManager&apos; defined in class path resource [org/springframework/boot/autoconfigure/cache/EhCacheCacheConfiguration.class]: Bean instantiation via factory method failed; nested exception is org.springframework.beans.BeanInstantiationException: Failed to instantiate [net.sf.ehcache.CacheManager]: Factory method &apos;ehCacheCacheManager&apos; threw exception; nested exception is net.sf.ehcache.CacheException: Another unnamed CacheManager already exists in the same VM. Please provide unique names for each CacheManager in the config or do one of following:</span><br><span class="line">1. Use one of the CacheManager.create() static factory methods to reuse same CacheManager with same name or create one if necessary</span><br><span class="line">2. Shutdown the earlier cacheManager before creating new one with same name.</span><br><span class="line"></span><br><span class="line">Caused by: org.springframework.beans.BeanInstantiationException: Failed to instantiate [net.sf.ehcache.CacheManager]: Factory method &apos;ehCacheCacheManager&apos; threw exception; nested exception is net.sf.ehcache.CacheException: Another unnamed CacheManager already exists in the same VM. Please provide unique names for each CacheManager in the config or do one of following:</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Versions of Ehcache before version 2.5 allowed any number of CacheManagers with the same name (same configuration resource) to exist in a JVM.</p>
<p>Ehcache 2.5 and higher does not allow multiple CacheManagers with the same name to exist in the same JVM. CacheManager() constructors creating non-Singleton CacheManagers can violate this rule</p>
</blockquote>
<p>맨 위에 적어둔 것 처럼 CacheManager의 생성 공유 <code>EhCacheManagerFactoryBean</code>  shared 옵션을 true로 두면 됨.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public EhCacheManagerFactoryBean ehCacheCacheManager() &#123;</span><br><span class="line">	EhCacheManagerFactoryBean cmfb = new EhCacheManagerFactoryBean();</span><br><span class="line">	cmfb.setConfigLocation(new ClassPathResource(&quot;ehcache.xml&quot;));</span><br><span class="line">	cmfb.setShared(true);</span><br><span class="line">	return cmfb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://stackoverflow.com/questions/10013288/another-unnamed-cachemanager-already-exists-in-the-same-vm-ehcache-2-5" target="_blank" rel="noopener">관련 StackOverflow 문서 링크</a></p>
<p>shared 설정은 cacheManager 싱글톤 여부를 지정하는 값이라고 하는데. cacheManager 인스턴스가 없으면 생성하도록 true 값을 지정하자. Shared 속성을 바꾸지 말고 acceptExisting 설정을 바꿔도 정상적으로 동작할 거라고 하는데 테스트는 안해봤다. acceptExisting는 이름 중복 사용여부인데, 동일한 이름이 있는 경우 생성하지 않도록 하는 속성이다. <a href="http://syaku.tistory.com/322" target="_blank" rel="noopener">관련 내용 링크</a></p>
<p>참고</p>
<ul>
<li><a href="http://jojoldu.tistory.com/57" target="_blank" rel="noopener">창천항로님의 블로그</a></li>
<li><a href="http://javacan.tistory.com/entry/133" target="_blank" rel="noopener">최범균님 블로그</a></li>
</ul>
<p>등등h</p>
</div><div class="article__tags"><a class="article__tags__item" href="/tags/Java/">Java</a><a class="article__tags__item" href="/tags/Spring/">Spring</a><a class="article__tags__item" href="/tags/EhCache/">EhCache</a></div><div class="article__author" itemscope itemprop="author" itemtype="https://schema.org/Person"><img class="article__author__image" src="/images/profile.png" alt="KyuNam"><a class="article__author__link" title="About KyuNam" rel="author">KyuNam</a><p class="article__author__desc">dev log</p><div class="article__author__socials"><a class="article__author__socials__item" href="https://github.com/tramyu" title="github" target="_blank"><i class="fa fa-github"></i></a><a class="article__author__socials__item" href="https://www.facebook.com/xmfpes" title="facebook" target="_blank"><i class="fa fa-facebook"></i></a><a class="article__author__socials__item" href="https://www.linkedin.com/feed/" title="linkedin" target="_blank"><i class="fa fa-linkedin"></i></a><a class="article__author__socials__item" href="https://www.instagram.com/" title="instagram" target="_blank"><i class="fa fa-instagram"></i></a><a class="article__author__socials__item" href="/atom.xml" title="rss" target="_blank"><i class="fa fa-rss"></i></a></div><meta itemprop="name" content="KyuNam"></div><div class="sharer" id="sharer"><div class="sharer-inner"><div class="sharer__right"><button class="sharer__item" id="sharer-facebook"><i class="fa fa-facebook-official"></i></button><button class="sharer__item" id="sharer-twitter"><i class="fa fa-twitter"></i></button><button class="sharer__item" id="sharer-pinterest"><i class="fa fa-pinterest"></i></button><button class="sharer__item" id="sharer-pocket"><i class="fa fa-get-pocket"></i></button></div></div></div><!-- Disqus Code--><div id="disqus_thread"></div><script>(function() {
  var d = document, s = d.createElement('script');
  s.src = '//kyunam-disqus-com.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();</script><noscript>Enable JavaScript to see comments.</noscript><!-- Meta Tags for Structured Data--><meta itemprop="dateModified" content="2018-08-05T16:08:59.026Z"><meta itemprop="articleBody" content="EhCache를 적용하려면 두가지 의존성을 추가해야 한다.
12compile('org.springframework.boot:spring-boot-starter-cache')compile group: 'net.sf.ehcache', name: 'ehcache', version: '2.9.0'
spring-boot-starter-cache 를 추가하면..."><meta itemprop="url" content="http://yoursite.com/java/spring/ehcache/"><meta itemprop="mainEntityOfPage" content="http://yoursite.com/java/spring/ehcache/"><div itemscope itemtype="https://schema.org/Organization" itemprop="publisher"><meta itemprop="name" content="Devlog"><div itemscope itemprop="logo" itemtype="https://schema.org/ImageObject"><meta itemprop="url" content="http://yoursite.com/images/internet.png"></div></div><div itemscope itemtype="https://schema.org/ImageObject" itemprop="image"><meta itemprop="contentUrl" content="http://yoursite.com/images/java/spring/spring.jpg"><meta itemprop="url" content="http://yoursite.com/images/java/spring/spring.jpg"><meta itemprop="width" content="1280"><meta itemprop="height" content="720"></div></article><section class="related-posts"><h3>Related posts</h3><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/java/spring/random-test-junit/"><div class="related-posts__item__background" style="background-image:url('/images/java/spring/spring.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">PasswordEncoder 관련 랜덤값 테스트 작성하기</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/java/spring/java-local-date-time-custom-serializer/"><div class="related-posts__item__background" style="background-image:url('/images/java/spring/spring.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">Java 8 LocalDateTime custom Deserializer, Serializer</span></a></div><div class="related-posts__item__wrapper"><a class="related-posts__item" href="/java/spring/spring-boot-angular-02/"><div class="related-posts__item__background" style="background-image:url('/images/java/spring/spring.jpg');"></div><div class="related-posts__item__overlay"></div><span class="related-posts__item__title">스프링 부트와 Angular로 게시판 만들기 - 2. Angular 프로젝트 초기 설정하기</span></a></div></section></div></div></div><footer id="footer"><div class="widgets"><div class="widgets-inner"><!-- Jade doesn't support dynamic inclusion with `each`.--><!-- So, I just hard coded the file names that will be included.--><div class="widgets__item"><h3 class="widgets__item__heading">Recent posts</h3><ul class="recent-posts"><li class="recent-posts__item"><a href="/java/spring/jpa-auditing/">Jpa Auditing 적용하기</a></li><li class="recent-posts__item"><a href="/etc/travis-mysql-setting/">Travis Setting up Mysql - Mysql 설정</a></li><li class="recent-posts__item"><a href="/java/spring/java-local-date-time-custom-serializer/">Java 8 LocalDateTime custom Deserializer, Serializer</a></li><li class="recent-posts__item"><a href="/java/spring/ehcache/">Spring Ehcache 적용하기</a></li><li class="recent-posts__item"><a href="/java/spring/random-test-junit/">PasswordEncoder 관련 랜덤값 테스트 작성하기</a></li></ul></div><div class="widgets__item"><h3 class="widgets__item__heading">Categories</h3><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Backend/">Backend</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Backend/Java/">Java</a><span class="category-list-count">13</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Backend/Java/DesignPattern/">DesignPattern</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Backend/Java/Spring/">Spring</a><span class="category-list-count">10</span></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/Hexo/">Hexo</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/CS/">CS</a><span class="category-list-count">21</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CS/Algorithm/">Algorithm</a><span class="category-list-count">20</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/CS/Datastructure/">Datastructure</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/">Frontend</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Frontend/Javascript/">Javascript</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Interview/">Interview</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Issue/">Issue</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a><span class="category-list-count">1</span></li></ul></div><div class="widgets__item"><h3 class="widgets__item__heading">Tag cloud</h3><div class="tag-cloud"><a href="/tags/AbstractFactory/" style="font-size: 0.9rem;">AbstractFactory</a> <a href="/tags/Algorithm/" style="font-size: 1.5rem;">Algorithm</a> <a href="/tags/Auditing/" style="font-size: 0.75rem;">Auditing</a> <a href="/tags/Cache/" style="font-size: 0.75rem;">Cache</a> <a href="/tags/EhCache/" style="font-size: 1.05rem;">EhCache</a> <a href="/tags/Graph/" style="font-size: 0.75rem;">Graph</a> <a href="/tags/Hexo/" style="font-size: 0.75rem;">Hexo</a> <a href="/tags/Interview/" style="font-size: 1.05rem;">Interview</a> <a href="/tags/JPA/" style="font-size: 0.75rem;">JPA</a> <a href="/tags/JUnit/" style="font-size: 0.75rem;">JUnit</a> <a href="/tags/Java/" style="font-size: 1.35rem;">Java</a> <a href="/tags/Javascript/" style="font-size: 0.9rem;">Javascript</a> <a href="/tags/Mybatis/" style="font-size: 0.75rem;">Mybatis</a> <a href="/tags/Spring/" style="font-size: 1.2rem;">Spring</a> <a href="/tags/Travis/" style="font-size: 0.75rem;">Travis</a></div></div></div></div><p class="copyright"><small>© 2018 KyuNam<br>Powered by <a href="https://hexo.io" rel="external" target="_blank">Hexo</a>, Theme by <a href="https://github.com/hyunseob" rel="external" target="_blank">HyunSeob</a></small></p></footer><script src="/js/sharer.min.js"></script></body></html>